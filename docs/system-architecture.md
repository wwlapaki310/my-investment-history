# システム構成ドキュメント

## アーキテクチャ概要

「私の投資ヒストリー」は、完全なクライアントサイドアプリケーションとして設計されています。
サーバーレス構成により、運用コスト0円で無期限に稼働可能です。

## システム構成図

```
┌─────────────────────────────────────────┐
│         ユーザーのブラウザ              │
│  ┌───────────────────────────────────┐  │
│  │      index.html (UI)              │  │
│  │  ┌─────────┐     ┌─────────┐     │  │
│  │  │ Input   │     │ Chart   │     │  │
│  │  │ Form    │────▶│ Display │     │  │
│  │  └─────────┘     └─────────┘     │  │
│  │         │              ▲          │  │
│  │         ▼              │          │  │
│  │  ┌──────────────────────────┐    │  │
│  │  │   JavaScript (app.js)    │    │  │
│  │  │  - Data Management       │    │  │
│  │  │  - Chart.js Integration  │    │  │
│  │  │  - Export/Import         │    │  │
│  │  └──────────────────────────┘    │  │
│  │         │              ▲          │  │
│  │         ▼              │          │  │
│  │  ┌──────────────────────────┐    │  │
│  │  │  localStorage (Browser)  │    │  │
│  │  │  - 投資履歴データ        │    │  │
│  │  │  - JSON形式              │    │  │
│  │  └──────────────────────────┘    │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
                 │
                 ▼
    ┌────────────────────────┐
    │   GitHub Pages         │
    │   - 静的ホスティング    │
    │   - HTTPS対応          │
    │   - CDN配信            │
    └────────────────────────┘
```

## 技術選定理由

### 1. フロントエンド技術

#### Vanilla JavaScript
**選定理由:**
- フレームワークの学習コスト不要
- ビルドプロセス不要（即座に動作）
- 軽量（バンドルサイズが小さい）
- 長期的な互換性（フレームワークの廃止リスクなし）

**代替案との比較:**
- React/Vue: 過剰な機能、ビルド必須
- jQuery: モダンブラウザでは不要

#### Chart.js
**選定理由:**
- シンプルなAPI
- 美しいデフォルトデザイン
- レスポンシブ対応
- アニメーション機能
- CDN経由で簡単に導入

**代替案との比較:**
- D3.js: 学習コストが高い
- Plotly.js: ファイルサイズが大きい

### 2. データ保存

#### localStorage
**選定理由:**
- サーバー不要（完全無料）
- 即座に読み書き可能
- 5-10MB の容量（十分）
- ブラウザ標準機能

**データ形式: JSON**
```json
{
  "history": [
    {
      "year": 2020,
      "amount": 1000000,
      "comment": "投資開始"
    }
  ],
  "metadata": {
    "lastUpdated": "2024-01-01T00:00:00Z",
    "version": "1.0"
  }
}
```

**制限事項:**
- ブラウザごとに独立（デバイス間同期なし）
- ブラウザデータクリアで消失
- 解決策: JSON エクスポート/インポート機能

### 3. ホスティング

#### GitHub Pages
**選定理由:**
- 完全無料
- HTTPSデフォルト対応
- CDN配信（高速）
- Git連携（バージョン管理）
- カスタムドメイン対応

**代替案との比較:**
- Vercel/Netlify: 同等機能だが移行コスト
- Firebase Hosting: 無料枠あるが設定複雑

## データフロー

### 1. データ入力フロー
```
ユーザー入力
    ↓
バリデーション
    ↓
メモリ内配列に追加
    ↓
localStorage へ保存
    ↓
Chart.js でグラフ更新
```

### 2. データ読み込みフロー
```
ページロード
    ↓
localStorage から読み込み
    ↓
JSON パース
    ↓
メモリ内配列に格納
    ↓
Chart.js でグラフ描画
```

### 3. データエクスポート/インポート
```
【エクスポート】
メモリ内データ → JSON文字列 → Blobオブジェクト → ダウンロード

【インポート】
ファイル選択 → FileReader → JSON パース → バリデーション → localStorage保存
```

## セキュリティ

### データプライバシー
- **サーバー送信なし**: すべてクライアント内で完結
- **暗号化不要**: サーバー保存しないため
- **個人情報**: ユーザーが明示的に入力したもののみ

### XSS対策
- `textContent` を使用（innerHTML は不使用）
- ユーザー入力のサニタイズ
- CSP（Content Security Policy）設定予定

## パフォーマンス

### 最適化ポイント
1. **CDN利用**: Chart.js を CDN から読み込み
2. **遅延ロード**: Chart.js は必要時のみ
3. **最小化**: 本番用CSS/JSは圧縮
4. **キャッシュ**: Service Worker 導入検討

### 想定パフォーマンス
- 初回ロード: < 1秒
- データ追加: < 100ms
- グラフ更新: < 200ms

## 拡張性

### フェーズ1: 現在（MVP）
- ローカル保存のみ
- 単一ユーザー
- 基本的なグラフ

### フェーズ2: 共有機能追加
**技術スタック:**
- Supabase（PostgreSQL + Auth）
- または Firebase（Firestore + Auth）

**追加機能:**
- ユーザー登録/ログイン
- 公開/非公開設定
- 他のユーザーの投資履歴閲覧
- コメント・いいね機能

**移行戦略:**
1. 既存コードそのまま（ローカルモード）
2. オプションでクラウド同期
3. データマイグレーション機能

### フェーズ3: 高度な分析
- 複数ポートフォリオ管理
- リターン計算（CAGR、シャープレシオ）
- ベンチマーク比較（S&P500など）
- AIによる投資アドバイス

## 運用コスト

### 現状（フェーズ1）
- **ホスティング**: $0（GitHub Pages）
- **ドメイン**: $0（github.io サブドメイン）
- **合計**: **$0/月**

### 拡張後（フェーズ2予想）
- **ホスティング**: $0（変わらず）
- **データベース**: $0（Supabase無料枠: 500MB, 50,000 MAU）
- **ドメイン**: $10-15/年（独自ドメイン取得時のみ）
- **合計**: **$0-1/月**

## 技術的課題と対策

### 課題1: ブラウザ間データ同期
**対策**: JSON エクスポート/インポート（現在）→ クラウド同期（将来）

### 課題2: データバックアップ
**対策**: 定期的なエクスポートを促すUI、自動バックアップ提案

### 課題3: モバイル対応
**対策**: レスポンシブデザイン、タッチ操作最適化

### 課題4: ブラウザ互換性
**対策**: モダンブラウザ（Chrome, Firefox, Safari, Edge）のみサポート

## まとめ

このシステム構成は以下の原則に基づいています:

1. **シンプル第一**: 最小限の技術で最大の価値
2. **コスト0円**: 完全無料で運用可能
3. **拡張可能**: 必要に応じて機能追加
4. **ユーザー第一**: データプライバシー重視

将来的にユーザーが増えた場合でも、段階的にスケールできる設計となっています。
